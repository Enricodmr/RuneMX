<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RuneMX | Quizz</title>

    
    <link rel="stylesheet" href="./../css/dashboards.css">
    <link rel="stylesheet" href="./../css/estilo.css" />
    <link rel="stylesheet" href="./../css/style.css">
    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
</head>
<body onload=" onloadEsconder()" style="background-color: #161618;">
    <div class="janela">


        <div class="header-left">

            <h1>RuneMX</h1>

            <div class="hello">
                <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
            </div>
            
            <div class="btn-nav-white">
                <a href="listarPosts.html">
                    <h3>Oque há de novo?</h3>
                </a>
            </div>
            <div class="btn-nav-white">
                <a href="Meuspost.html">
                    <h3>Meus posts</h3>
                </a>
            </div>



            <div class="btn-nav-white">
                <a href="./quizz.html">
                    <h3>Quizz</h3>
                </a>
            </div>

            <div class="btn-nav-white">
                <a href="./publicar.html">
                    <h3>Publicar</h3>
                </a>
            </div>
            <div class="btn-nav-white">
                <a href="./dashboard.html">
                    <h3>Gráficos</h3>
                </a>
            </div>

            <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>

        </div>

        </div>

        </div>

        <div class="dash-right">


            <div class="avisos">
                <div id="alerta">
                </div>
                <div class="container">
                    <div id="divtitulo">
                        <h1>Inicie o Quizz!</h1>
                    </div>
                        <div id="div_perguntas">
                            <div id="pontuacaoEJogo">
        <button id="btnIniciarQuiz" onclick="iniciarQuiz()" class="botao_quizz">INICIAR QUIZ</button>

        <div id="pontuacao" class="flex-colunar width-fit-content border-primary">
            <div id="pontuacaoDuranteJogo" class="flex-colunar padding-8">
                <span class="width-fit-content">Quantidade de acertos: <span id="spanCertas"></span></span>
                <span class="width-fit-content">Quantidade de erros: <span id="spanErradas"></span></span>
            </div>
            <div id="pontuacaoFinalJogo" class="flex-colunar padding-8">
                <span id="pontuacaoFinal" class="width-fit-content">Pontuação Final:
                    <span id="spanPontuacaoFinal">***</span>
                </span>
                <span id="msgFinal" class="msg-final">***</span>
            </div>
        </div>

        <div id="jogo" class="width-fit-content flex-colunar border-secondary div-pergunta">

            <div id="infoQuestao" class="padding-8">
                <span>Questão atual: <span id="spanNumeroDaQuestaoAtual"></span> de <span id="qtdQuestoes"></span>
                    questões.</span>
            </div>

            <div id="perguntaDaQuestaoAtual" class="padding-8">
                <span id="spanQuestaoExibida" class="text-bold"></span>
            </div>

            <div id="infoAlternativas" class="padding-8">
                <span><em>Escolha uma opção dentre as abaixo:</em></span>
            </div>

            <div id="opcoes" class="flex-colunar padding-8">
                <button id="btnOpcaoA" class="botao_opcao" onclick="submeter('alternativaA')"></button>
                <button id="btnOpcaoB" class="botao_opcao" onclick="submeter('alternativaB')"></button>
                <button id="btnOpcaoC" class="botao_opcao" onclick="submeter('alternativaC')"></button>
                <button id="btnOpcaoD" class="botao_opcao" onclick="submeter('alternativaD')"></button>
            </div>
            

            <div id="botoes" class="flex-row padding-8">
                <button onclick="tentarNovamente()" id="btnTentarNovamente" class="botao_resposta">Tentar novamente</button>
            </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<script>
     b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    const listaDeQuestoes = [

    {
            pergunta: "Quem é a irmã da Violet (Vi)?",
            alternativaA: "Powder",
            alternativaB: "Caitlyn",
            alternativaC: "Ambessa",
            alternativaD: "Isha",
            alternativaCorreta: "alternativaA"
        },

        {
            pergunta: "Quem foi acusado de matar o mestre na guerra de Ionia e Noxus?",
            alternativaA: "Yone",
            alternativaB: "Riven",
            alternativaC: "Ahri",
            alternativaD: "Yasuo",
            alternativaCorreta: "alternativaD"
        },

        {
            pergunta: "Qual deste campeões não é de Bandopólis?",
            alternativaA: "Teemo",
            alternativaB: "Annie",
            alternativaC: "Rumble",
            alternativaD: "Tristana",
            alternativaCorreta: "alternativaB"
        },
        {
            pergunta: "Quais desses campeões não são irmãos?",
            alternativaA: "Katarina e Talon",
            alternativaB: "Kayle e Morgana",
            alternativaC: "Yasuo e Yone",
            alternativaD: "Zed e Shen",
            alternativaCorreta: "alternativaD"
        },

        {
            pergunta: "Qual campeão não é hospedeiro de um darkin?",
            alternativaA:"Naafiri",
            alternativaB:"Aatrox",
            alternativaC:"Swain",
            alternativaD:"Kayn",
            alternativaCorreta:"alternativaC"
        },

        {
            pergunta: "Qual membro da familia Du couteau foi adotado?",
            alternativaA:"Talon",
            alternativaB:"Katarina",
            alternativaC:"Cassiopeia",
            alternativaD:"Shyvanna",
            alternativaCorreta:"alternativaA"
        },
        {
            pergunta: "Qual desses campeões não pertence ao vazio?",
            alternativaA:"Vel'Koz",
            alternativaB:"Kai'Sa",
            alternativaC:"Ryze",
            alternativaD:"Malzahar",
            alternativaCorreta:"alternativaC"
        },
        {
            pergunta: "Qual campeão matou a Senna?",
            alternativaA:"Thresh",
            alternativaB:"Hecarim",
            alternativaC:"Karthus",
            alternativaD:"Viego",
            alternativaCorreta:"alternativaA"
        },
        {
            pergunta: "Qual desses campeões não é Vastaya?",
            alternativaA:"Wukong",
            alternativaB:"Nami",
            alternativaC:"Xayah",
            alternativaD:"Ivern",
            alternativaCorreta:"alternativaD"
        },
        {
            pergunta: "Quem criou a Orianna?",
            alternativaA:"Heimerdinger",
            alternativaB:"Singed",
            alternativaC:"Ekko",
            alternativaD:"Viktor",
            alternativaCorreta:"alternativaB"
        },
        {
            pergunta: "Qual desses campeões não são rivais?",
            alternativaA:"Gangplank e Miss Fortune",
            alternativaB:"Kayle e Morgana",
            alternativaC:"Tryndamere e Ashe",
            alternativaD:"Irelia e Swain",
            alternativaCorreta:"alternativaC"
        },
        {
            pergunta: "Qual o nome da irmã do Aphelios?",
            alternativaA:"Alune",
            alternativaB:"Alice",
            alternativaC:"Alana",
            alternativaD:"Aline",
            alternativaCorreta:"alternativaA"
        },
        {
            pergunta: "Em que ano League of Legends foi lançado?",
            alternativaA:"2007",
            alternativaB:"2008",
            alternativaC:"2009",
            alternativaD:"2010",
            alternativaCorreta:"alternativaC"
        },
        {
            pergunta: "Em qual região Sylas foi preso?",
            alternativaA:"Noxus",
            alternativaB:"Ionia",
            alternativaC:"Demacia",
            alternativaD:"Shurima",
            alternativaCorreta:"alternativaC"
        },
        {
            pergunta: "Qual dessas campeãs não fazem parte do grupo K/DA?",
            alternativaA:"Sona",
            alternativaB:"Akali",
            alternativaC:"Seraphine",
            alternativaD:"Ahri",
            alternativaCorreta:"alternativaA"
        }

    ]

    // variáveis globais    
    let numeroDaQuestaoAtual = 0
    let pontuacaoFinal = 0
    let tentativaIncorreta = 0
    let certas = 0
    let erradas = 0
    let quantidadeDeQuestoes = listaDeQuestoes.length
    // let isUltima = numeroDaQuestaoAtual == quantidadeDeQuestoes-1 ? true : false

    function onloadEsconder() {
        document.getElementById('pontuacao').style.display = "none"
        document.getElementById('jogo').style.display = "none"
    }

    function iniciarQuiz() {
        document.getElementById('pontuacao').style.display = "none"
        document.getElementById('jogo').style.display = "flex"
        document.getElementById('btnIniciarQuiz').style.display = "none"
        document.getElementById('divtitulo').innerHTML = `<br><br><br>`

        document.getElementById('qtdQuestoes').innerHTML = quantidadeDeQuestoes

        preencherHTMLcomQuestaoAtual(0)

        btnSubmeter.disabled = false
        // btnConcluir.disabled = true
    }

    function preencherHTMLcomQuestaoAtual(index) {
    const questaoAtual = listaDeQuestoes[index];
    numeroDaQuestaoAtual = index;

    document.getElementById("spanNumeroDaQuestaoAtual").innerHTML = Number(index) + 1; // ajustando porque o index começa em 0
    document.getElementById("spanQuestaoExibida").innerHTML = questaoAtual.pergunta;

    document.getElementById("btnOpcaoA").innerHTML = questaoAtual.alternativaA;
    document.getElementById("btnOpcaoB").innerHTML = questaoAtual.alternativaB;
    document.getElementById("btnOpcaoC").innerHTML = questaoAtual.alternativaC;
    document.getElementById("btnOpcaoD").innerHTML = questaoAtual.alternativaD;
}


function submeter(alternativaEscolhida) {
    const questaoAtual = listaDeQuestoes[numeroDaQuestaoAtual];
    const respostaCorreta = questaoAtual.alternativaCorreta;

    if (alternativaEscolhida === respostaCorreta) {
        // Adiciona classe de sucesso
        document.getElementById(`btnOpcao${respostaCorreta.charAt(respostaCorreta.length - 1).toUpperCase()}`)
            .classList.add("text-success-with-bg");
        pontuacaoFinal++;
        certas++;
        document.getElementById("spanCertas").innerHTML = certas;
    } else {
        // Marca a alternativa errada
        document.getElementById(`btnOpcao${alternativaEscolhida.charAt(alternativaEscolhida.length - 1).toUpperCase()}`)
            .classList.add("text-danger-with-bg");

        // Marca a resposta correta
        document.getElementById(`btnOpcao${respostaCorreta.charAt(respostaCorreta.length - 1).toUpperCase()}`)
            .classList.add("text-success-with-bg");

        tentativaIncorreta++;
        erradas++;
        document.getElementById("spanErradas").innerHTML = erradas;
    }

    numeroDaQuestaoAtual++;

    // Aguarda 1.5s e avança para a próxima questão
    setTimeout(() => {
        if (numeroDaQuestaoAtual < listaDeQuestoes.length) {
            limparCoresBackgroundOpcoes();
            preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual);
        } else {
            finalizarJogo();
        }
    }, 1500);
}

    function habilitarAlternativas(trueOrFalse) {
        let opcaoEscolhida = trueOrFalse ? false : true

        primeiraOpcao.disabled = opcaoEscolhida
        segundaOpcao.disabled = opcaoEscolhida
        terceiraOpcao.disabled = opcaoEscolhida
        quartaOpcao.disabled = opcaoEscolhida

    }

    function avancar() {
        btnSubmeter.disabled = false

        desmarcarRadioButtons()

        if (numeroDaQuestaoAtual < quantidadeDeQuestoes - 1) {
            preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
        } else if (numeroDaQuestaoAtual == quantidadeDeQuestoes - 1) {
            alert("Atenção... a próxima é a ultima questão!")
            preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
        } else {
            finalizarJogo()
        }
        limparCoresBackgroundOpcoes()
    }

    function tentarNovamente() {
        // atualiza a página
        window.location.reload()
    }

    function checarResposta() {
        const questaoAtual = listaDeQuestoes[numeroDaQuestaoAtual] 
        const respostaQuestaoAtual = questaoAtual.alternativaCorreta 

        const options = document.getElementsByName("option"); 

        let alternativaCorreta = null

        options.forEach((option) => {
            if (option.value === respostaQuestaoAtual) {
                console.log("alternativaCorreta está no componente: " + alternativaCorreta)
                alternativaCorreta = option.labels[0].id
            }
        })

        options.forEach((option) => {
            if (option.checked === true && option.value === respostaQuestaoAtual) {
                document.getElementById(alternativaCorreta).classList.add("text-success-with-bg")
                pontuacaoFinal++
                certas++
                document.getElementById("spanCertas").innerHTML = certas
                numeroDaQuestaoAtual++

                setTimeout(avancar, 1500)
            } else if (option.checked && option.value !== respostaQuestaoAtual) {
                const wrongLabelId = option.labels[0].id

                document.getElementById(wrongLabelId).classList.add("text-danger-with-bg")
                document.getElementById(alternativaCorreta).classList.add("text-success-with-bg")
                tentativaIncorreta++
                erradas++
                document.getElementById("spanErradas").innerHTML = erradas
                numeroDaQuestaoAtual++

            }

            if(questaoAtual >= listaDeQuestoes.length){
                setTimeout(avancar, 1500)
            }else{
                console.log('Questão atual = '+ questaoAtual)
                console.log('Tamanho da listaDeQuestoes = ' + listaDeQuestoes.length)
            }
        })
    }

    function limparCoresBackgroundOpcoes() {
    const botoes = ["btnOpcaoA", "btnOpcaoB", "btnOpcaoC", "btnOpcaoD"];
    botoes.forEach(id => {
        const botao = document.getElementById(id);
        botao.classList.remove("text-danger-with-bg", "text-success-with-bg");
    });
}


    function desmarcarRadioButtons() {
        const options = document.getElementsByName("option");
        for (let i = 0; i < options.length; i++) {
            options[i].checked = false;
        }
    }

    function finalizarJogo() {
    document.getElementById('pontuacao').style.display = "flex";
    document.getElementById('jogo').style.display = "none";

    let textoParaMensagemFinal = null;
    const porcentagemFinalDeAcertos = pontuacaoFinal / quantidadeDeQuestoes;

    if (porcentagemFinalDeAcertos <= 0.3) {
        textoParaMensagemFinal = "Parece que você não estudou...";
    } else if (porcentagemFinalDeAcertos < 0.9) {
        textoParaMensagemFinal = "Pode melhorar na próxima, hein!";
    } else {
        textoParaMensagemFinal = "Uau, parabéns!";
    }

    textoParaMensagemFinal += `<br> Você acertou ${Math.round(porcentagemFinalDeAcertos * 100)}% das questões.`;

    document.getElementById('msgFinal').innerHTML = textoParaMensagemFinal;
    document.getElementById('spanPontuacaoFinal').innerHTML = pontuacaoFinal;

    cadastrarPontos(pontuacaoFinal)
}

function cadastrarPontos(pontuacaoFinal) {
        const idUsuario = sessionStorage.ID_USUARIO; 
        sessionStorage.Pontos = pontuacaoFinal //ARMAZENANDO QTD DE PTS DO USUARIO NA SessionStorage
        
        //requisicao cadastrar pontos
        fetch("/quizz/cadastrarPontos", {
        method: "POST",
        headers: {
        "Content-Type": "application/json",
        },
        body: JSON.stringify({ pontos: pontuacaoFinal, idUsuario: idUsuario }), //atribuindo valor ao json, pontos
        })
        .then((response) => response.json())
        .then((data) => {
        console.log("Pontuação cadastrada com sucesso:", data);
        })
        .catch((error) => {
        console.error("Erro ao cadastrar a pontuação:", error);
        });
    };
</script>